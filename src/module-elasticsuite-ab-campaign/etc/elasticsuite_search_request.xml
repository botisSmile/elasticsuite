<?xml version="1.0"?>
<!--
/**
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Smile ElasticSuite to newer
 * versions in the future.
 *
 * @category  Smile
 * @package   Smile\ElasticsuiteAbCampaign
 * @author    Botis <botis@smile.fr>
 * @copyright 2021 Smile
 * @license   Open Software License ("OSL") v. 3.0
 */
 -->
<requests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="urn:magento:module:Smile_ElasticsuiteCore:etc/elasticsuite_search_request.xsd">

    <!-- Session log event aggregator ab campaign request using tracking_log_event to get ab campaign data -->
    <request name="session_aggregator_ab_campaign" label="Session log event aggregatorfor ab campaign data" index="tracking_log_event" type="event" fulltext="false">
        <aggregations>
            <aggregation xsi:type="termBucket" name="session_id" field="session.uid">
                <aggregations>
                    <aggregation xsi:type="termBucket" name="campaigns" field="page.ab_campaign.id">
                        <aggregations>
                            <aggregation xsi:type="termBucket" name="campaign_scenario" field="page.ab_campaign.scenario" />
                        </aggregations>
                    </aggregation>
                </aggregations>
            </aggregation>
        </aggregations>
    </request>
</requests>
