<?xml version="1.0"?>
<!--
/**
 * Smile_ElasticsuiteExplain dependency injection configuration.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this module to newer
 * versions in the future.
 *
 * @category  Smile
 * @package   Smile\ElasticsuiteExplain
 * @author    Romain Ruaud <romain.ruaud@smile.fr>
 * @copyright 2021 Smile
 * @license   Licensed to Smile-SA. All rights reserved. No warranty, explicit or implicit, provided.
 *            Unauthorized copying of this file, via any medium, is strictly prohibited.
 */
 -->
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <type name="Smile\ElasticsuiteExplain\Model\Result\Item\DescriptionsGenerator">
        <arguments>
            <argument name="analyzers" xsi:type="array">
                <item name="phonetic" xsi:type="string" translate="true">A variation of a searchable field used for phonetic matching, it does contain representation of sounds.</item>
                <item name="standard" xsi:type="string" translate="true">The default version of a searchable field that includes language dependent word analysis (singular/plural forms, conjugated verbs, etc).</item>
                <item name="shingle" xsi:type="string" translate="true">A variation of an indexed field used for phrase matching, when searching several words.</item>
                <item name="untouched" xsi:type="string" translate="true">An unaltered version of an indexed field content, including spaces and punctuation, used for filtering product lists.</item>
                <item name="whitespace" xsi:type="string" translate="true">A variation of a searchable field with minimal changes, used for exact matching.</item>
            </argument>
            <argument name="defaultFields" xsi:type="array">
                <item name="search" xsi:type="string" translate="true">A default search field where every other searchable attribute or field text data is copied into.</item>
                <item name="spelling" xsi:type="string" translate="true">A default search field containing the text data of every searchable attribute with spellchecking enabled.</item>
                <item name="autocomplete" xsi:type="string" translate="true">A default search field historically used to contain all the text data of searchable attributes enabled for autocomplete search. Deprecated.</item>
            </argument>
        </arguments>
    </type>

    <!-- ES index handler declaration -->
    <virtualType name="optimizerSearchIndexHandler" type="\Smile\ElasticsuiteCore\Indexer\GenericIndexerHandler">
        <arguments>
            <argument name="indexName" xsi:type="const">Smile\ElasticsuiteExplain\Model\Indexer\Optimizer\Percolator::INDEX_IDENTIFIER</argument>
            <argument name="typeName" xsi:type="string">optimizer</argument>
        </arguments>
    </virtualType>

    <!-- ES indexer declaration -->
    <type name="Smile\ElasticsuiteExplain\Model\Indexer\Optimizer\Percolator">
        <arguments>
            <argument name="indexerHandler" xsi:type="object">optimizerSearchIndexHandler</argument>
        </arguments>
    </type>

    <!-- Since ES 5, indices containing percolator queries should have a mapping
         which reflects the mapping of the index you wanna percolate query against -->
    <type name="Smile\ElasticsuiteCore\Api\Index\IndexOperationInterface">
        <plugin name="merge_percolator_mapping" type="Smile\ElasticsuiteExplain\Plugin\Index\IndexOperation"/>
    </type>

    <!-- Datasources resolver -->
    <type name="Smile\ElasticsuiteCore\Index\DataSourceResolver">
        <arguments>
            <argument name="datasources" xsi:type="array">
                <item name="optimizer" xsi:type="array">
                    <item name="percolator" xsi:type="object">Smile\ElasticsuiteExplain\Model\Indexer\Optimizer\Percolator\Datasource\PercolatorData</item>
                </item>
            </argument>
        </arguments>
    </type>
</config>

